<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interview Main Page</title>
    <link
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    rel="stylesheet"
  />
    <style>
      /* Overall body styling */
      #candidate-response{
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); /* Black box shadow */
            border: solid rgba(0, 0, 0, 0.223);

        }

        #flashing-text {
  animation: flash-colors 2s infinite; /* Change colors every 2 seconds */
       }

@keyframes flash-colors {
  0% {
    color: green; /* First color */
  }
  33% {
    color: blue; /* Second color */
  }
  66% {
    color: red; /* Third color */
  }
  100% {
    color: green; /* Back to first color */
  }
}

        .imgg{
            border-radius: 10px;
        }
        .language-box{
            background-color: #c2edf6;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); /* Black box shadow */


        }
        #language{
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            padding: 8px;
        }
        .heading{
            /* background-color: rgb(250, 228, 186); */
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }
        .stats-container{
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            background: #e0f7fa;
            border-radius: 10px;
            border: solid black;
        }
        .stat-material{
            padding: 20px;
            justify-content: center;

        }
        .chat-interface{
            border: solid black;
        }
        .chat-interface {
        border: 2px solid #ccc;
        border-radius: 8px;
        border: solid rgba(2, 40, 76, 0.149);
        padding: 15px;
        height: 400px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); /* Black box shadow */
        /* box-shadow: #c2edf6; */
        overflow-y: auto;
        background-color: #e6f0f3;
        display: flex;
        flex-direction: column;
      }

      /* Chat message styles */
      .message {
        margin-bottom: 10px;
      }
      .ai-message {
        background-color: #e0f7fa;
        padding: 10px;
        border-radius: 10px;
        align-self: flex-start;
      }
      .candidate-message {
        background-color: #d1c4e9;
        padding: 10px;
        border-radius: 10px;
        align-self: flex-end;
      }

      /* Input area for candidate response */
      /* .input-area {
        display: flex;
        align-items: center;
        margin-top: 15px;
      } */

      .mic-button,
      .submit-button {
        /* margin-left: 10px; */
        /* padding: 10px; */
        cursor: pointer;
      }

      /* Camera frame styling */
      .camera-frame {
        width: 450px; /* Set the width of the camera frame */
        height: 380px; /* Set the height of the camera frame */
        border: 2px solid black;
        border-radius: 10px;
        margin-bottom: 20px;
        margin-top: 20px;

        background-color: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); /* Black box shadow */
        margin-top: 98px;
      }

      /* Styling for the person count text */
      /* .person-count {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 5px;
        font-size: 18px;

      } */

      /* .camera-frame {
        border: 2px solid black;
        border-radius: 8px;
        background-color: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); 
        margin-top: 98px;

      } */
       /* cheeating style */
       .cheating-alert {
        font-size: 1.5rem;
        color: red;
        font-weight: bold;
        /* margin-top: 20px; */
        visibility: hidden;
      }

      .stat-item {
        margin-bottom: 10px;
      }

    </style>
  </head>
  <!-- <body> -->
    <body   style="background-image: url('{{ url_for('static', filename='bg.png') }}');" class="container mt-4">
<div class="row">
    <div class="col-md-6">

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="heading">
            <!-- <h1>All The Best {{ candidate_name }}</h1> -->
            <h1>Welcome {{ candidate_name }}</h1>
          </div>
          <div class="language-box">
            <p class="text-center" id="language">Selected Language: {{ language }}</p>
          </div>
      <button type="button"  class="btn btn-primary mb-3" id="startButton" onclick="submitResponse()">
        Start Questions!
      </button>

      <!-- Chat Interface -->
      <div class="chat-interface" id="chatInterface">
        <!-- <button type="button" id="startButton" onclick="startAI()">Start Questions!</button>              -->
        <div class="message ai-message"></div>
      </div>

      <!-- Input Area for Candidate Response -->
      <div class="input-area mt-3">
        <textarea
          id="candidate-response"
          style="border-radius: 8px;"
              class="form-control"
              rows="2"
          placeholder="Type your response here..."
        ></textarea>
      <div class="mt-2 d-flex">
        
        <div class="mt-2 d-flex">


        <button class="btn btn-secondary mr-2 mic-button" onclick="startRecording()">ðŸŽ¤</button>
        <button class="submit-button btn btn-success" onclick="submitResponse()">Submit</button>
        </div>

      </div>

      <button id="SeeAnalysis" class="btn btn-info mt-3" onclick="AnalysisButtton()">See Analysis</button>
      <p> <span id="flashing-text" > Upon completing the interview, click the Analysis button to review your results. </span></p>

    </div>
</div>
</div>
         
    
    <!-- Info Section Below the Camera -->
<div class="col-md-6">

    <div class="camera-frame">
        <div class="video-container">
          <!-- <h3>Webcam Feed</h3> -->
          <img class="imgg"
            src="{{ url_for('video_feed') }}"
            alt="Camera Feed"
            style="height: 310px; width: 400px"
          />
        </div>
      </div>

<!-- Info Section Below the Camera -->

    <div class="stats-container">
        <div class="stat-material text-center">
        <div id="personCount" class="stat-item">Persons Detected: 0</div>
        <div id="confidenceScore" class="stat-item">Emotion Confidence: 0%</div>
        <div id="questionsAttempted" class="stat-item">Questions Attempted: 0</div>
        <div id="questionsRemaining" class="stat-item">Questions Remaining: 0</div>
        <div id="cheatingAlert" class="cheating-alert">No Cheating Detected</div>
      </div>
    </div>
    </div>
<!-- </div> -->



<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    
<script>
function  AnalysisButtton(){
  window.location.href = '/analysis'
}

      function startAI() {
        // Send a POST request to the backend
        fetch("/submit_response", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ response: "" }), // Empty response initially
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Backend response:", data.reply);
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>


    <script>
      // Function to fetch the face count from the backend
      function updatePersonCount() {
        fetch("/person_count")
          .then((response) => response.json())
          .then((data) => {
            // Update the person count display
            const personCountElement = document.getElementById("personCount");
            const confidenceScore = document.getElementById("confidenceScore");
            const questionsAttempted =
              document.getElementById("questionsAttempted");
            const questionsRemaining =
              document.getElementById("questionsRemaining");

            personCountElement.innerText = `Persons Detected: ${data.count}`;
            confidenceScore.innerText = `Confidence Score: ${data.confidence}`;
            questionsAttempted.innerText =`Question Attempted: ${data.attempted}`;
            questionsRemaining.innerText = `Question remaining: ${data.remaining}`;
            // Update the cheating alert based on the face count
            const cheatingAlertElement =
              document.getElementById("cheatingAlert");
            if (data.count > 1) {
              cheatingAlertElement.innerText =
                "Warning: Multiple Persons Detected!";
              cheatingAlertElement.style.visibility = "visible";
            } else {
              cheatingAlertElement.innerText = "No Cheating Detected";
              cheatingAlertElement.style.visibility = "hidden";
            }
          })
          .catch((error) =>
            console.error("Error fetching person count:", error)
          );
      }

      // Update the count every second (1000 milliseconds)
      setInterval(updatePersonCount, 1000);
    </script>

    <script>
      // Chat interface updates
      const chatInterface = document.getElementById("chatInterface");

      function addMessage(content, isCandidate = false) {
        const messageElement = document.createElement("div");
        messageElement.className = isCandidate
          ? "message candidate-message"
          : "message ai-message";
        messageElement.textContent = content;
        chatInterface.appendChild(messageElement);
        chatInterface.scrollTop = chatInterface.scrollHeight;
      }

      temp = 0;
      // Submit candidate response to the backend
      function submitResponse() {
        console.log("main aekjdb", temp);
        const response = document.getElementById("candidate-response").value;
        if (temp > 0) {
          addMessage("Candidate: " + response, true);
        }
        temp = temp + 1;
        document.getElementById("candidate-response").value = "";
        data = ''
        // Send response to the backend
        fetch("/submit_response", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ response: response }),
        })
          .then((response) => response.json())
          .then((data) => addMessage("AI: " + data.reply));
        console.log("data.reply-->",data.reply);
        console.log(data.analysis);

        if(data.analysis == 'view_analysis')
        {
          console.log("munna");
          
          window.location.href = "/analysis";
        }
      }

      // Microphone functionality
      let recognition;
      function startRecording() {
        if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
          alert("Speech recognition not supported in this browser.");
          return;
        }
        recognition = new (window.SpeechRecognition ||
          window.webkitSpeechRecognition)();
        recognition.lang = "en-US";
        recognition.start();

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript;
          document.getElementById("candidate-response").value = transcript;
        };
      }

      // Person count update
      let personCountElement = document.getElementById("personCount");
      let Cheating = document.getElementById("Cheating");
      function updatePersonCount(count) {
        personCountElement.textContent = "Persons Detected: " + count;
      }
    </script>
  </body>
</html>